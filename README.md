# Simple Car

å¼€æº RC é¥æ§è½¦é¡¹ç›® â€”â€” ä½¿ç”¨ä¸¤éƒ¨æ‰‹æœº + ESP32 å®ç°å®æ—¶è§†é¢‘å›¾ä¼ å’Œé¥æ§ã€‚

## å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    IPv6/TCP     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      BLE       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¥æ”¶ç«¯æ‰‹æœº   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚   å‘é€ç«¯æ‰‹æœº   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  ESP32   â”‚
â”‚  (é¥æ§ + çœ‹)  â”‚  WebRTCè§†é¢‘æµ   â”‚  (è½¦ä¸Šæ‘„åƒå¤´)  â”‚  æ§åˆ¶æŒ‡ä»¤      â”‚ (PWMè¾“å‡º) â”‚
â”‚              â”‚  æ§åˆ¶æŒ‡ä»¤        â”‚              â”‚               â”‚          â”‚
â”‚  æ‘‡æ† â†’ RCæŒ‡ä»¤ â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  GPS/ç”µé‡/çŠ¶æ€  â”‚               â”‚ èˆµæœº+ç”µè°ƒ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    ä¿¡ä»¤é€šé“      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®æµï¼š**
1. **æ¥æ”¶ç«¯**ï¼ˆä½ æ‰‹é‡Œçš„æ‰‹æœºï¼‰ï¼šæ‰«ç è¿æ¥å‘é€ç«¯ï¼Œæ˜¾ç¤ºå®æ—¶è§†é¢‘ï¼Œé€šè¿‡æ‘‡æ†å‘é€æ§åˆ¶æŒ‡ä»¤
2. **å‘é€ç«¯**ï¼ˆè£…åœ¨è½¦ä¸Šçš„æ‰‹æœºï¼‰ï¼šé‡‡é›†æ‘„åƒå¤´ç”»é¢é€šè¿‡ WebRTC ä¼ è¾“ï¼Œæ¥æ”¶æ§åˆ¶æŒ‡ä»¤å¹¶é€šè¿‡ BLE è½¬å‘ç»™ ESP32
3. **ESP32**ï¼ˆESP32-C3 Super Miniï¼‰ï¼šæ¥æ”¶ BLE æ§åˆ¶æŒ‡ä»¤ï¼Œè¾“å‡º PWM ä¿¡å·é©±åŠ¨èˆµæœºå’Œç”µè°ƒ

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“¹ **å®æ—¶è§†é¢‘å›¾ä¼ ** â€” åŸºäº WebRTCï¼Œæ”¯æŒå¤šåˆ†è¾¨ç‡åˆ‡æ¢ï¼ˆ480p ~ 1080pï¼‰
- ğŸ® **é¥æ§æ§åˆ¶** â€” å•æ‘‡æ† / åŒæ‘‡æ†æ¨¡å¼ï¼Œå¯è°ƒæ–¹å‘å’Œæ²¹é—¨åŠ›åº¦
- ğŸ“ **GPS å®šä½** â€” å®æ—¶æ˜¾ç¤ºè½¦è¾†ä½ç½®å’Œé€Ÿåº¦ï¼ˆåœ°å›¾ + é€Ÿåº¦è¡¨ï¼‰
- ğŸ”¦ **è¿œç¨‹æ§åˆ¶** â€” æ‰‹ç”µç­’ã€æ‘„åƒå¤´åˆ‡æ¢ã€ç”»ä¸­ç”»åŒæ‘„
- ğŸ¤ **è¯­éŸ³å¯¹è®²** â€” é•¿æŒ‰ PTT å¯¹è®²ï¼Œæ”¯æŒéŸ³é¢‘æ–‡ä»¶æ’­æ”¾
- ğŸ”‹ **ç”µé‡ç›‘æ§** â€” æ‰‹æœºç”µé‡ + ESP32 è½¦è¾†ç”µæ± ç”µé‡
- ğŸ”— **æ‰«ç è¿æ¥** â€” å‘é€ç«¯ç”Ÿæˆ QR ç ï¼Œæ¥æ”¶ç«¯æ‰«ç ç›´è¿ï¼ˆIPv6ï¼‰

## ç¡¬ä»¶éœ€æ±‚

| ç»„ä»¶ | è¯´æ˜ |
|------|------|
| Android æ‰‹æœº Ã— 2 | ä¸€éƒ¨è£…è½¦ï¼Œä¸€éƒ¨é¥æ§ï¼ˆéœ€æ”¯æŒ IPv6ï¼‰ |
| ESP32-C3 Super Mini | BLE æ§åˆ¶å™¨ï¼Œè¾“å‡º PWM |
| RC è½¦åº•ç›˜ | å¸¦èˆµæœº + ç”µè°ƒ |
| 2S LiPo ç”µæ±  | ç»™è½¦å’Œ ESP32 ä¾›ç”µ |

## ç”µè·¯è¿æ¥

è¯¦è§ [`firmware/CIRCUIT.md`](firmware/CIRCUIT.md)

```
ESP32-C3 GPIO6  â”€â”€>  èˆµæœºä¿¡å·çº¿ (PWM è½¬å‘)
ESP32-C3 GPIO7  â”€â”€>  ç”µè°ƒä¿¡å·çº¿ (PWM æ²¹é—¨)
ESP32-C3 GPIO3  â”€â”€>  ç”µæ± æ£€æµ‹ (100KÎ© + 47KÎ© åˆ†å‹)
```

## å¿«é€Ÿå¼€å§‹

### 1. çƒ§å½• ESP32 å›ºä»¶

éœ€è¦ [PlatformIO](https://platformio.org/)ï¼š

```bash
cd firmware
pio run --target upload
```

### 2. æ„å»º Flutter App

éœ€è¦ [Flutter SDK](https://flutter.dev/)ï¼š

```bash
cd app
flutter pub get
flutter build apk
```

ä¸¤éƒ¨æ‰‹æœºéƒ½å®‰è£…åŒä¸€ä¸ª APKã€‚

### 3. ä½¿ç”¨

1. **å‘é€ç«¯æ‰‹æœº**è£…åœ¨è½¦ä¸Šï¼Œæ‰“å¼€ App é€‰æ‹©ã€Œå‘é€ç«¯ã€ï¼Œç­‰å¾…ç”ŸæˆäºŒç»´ç 
2. **æ¥æ”¶ç«¯æ‰‹æœº**æ‰“å¼€ App é€‰æ‹©ã€Œæ¥æ”¶ç«¯ã€ï¼Œæ‰«æäºŒç»´ç è¿æ¥
3. è¿æ¥æˆåŠŸåå³å¯çœ‹åˆ°è§†é¢‘ç”»é¢ï¼Œç”¨æ‘‡æ†æ§åˆ¶è½¦è¾†

## é¡¹ç›®ç»“æ„

```
simple-car/
â”œâ”€â”€ app/                          # Flutter æ‰‹æœº App
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ main.dart             # å…¥å£
â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â”œâ”€â”€ role_selection_screen.dart   # è§’è‰²é€‰æ‹©ï¼ˆå‘é€ç«¯/æ¥æ”¶ç«¯ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ sender_screen.dart          # å‘é€ç«¯ï¼ˆæ‘„åƒå¤´ + QRç  + ESP32ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ receiver_screen.dart        # æ¥æ”¶ç«¯ï¼ˆè§†é¢‘ + æ‘‡æ† + æ§åˆ¶ï¼‰
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â”œâ”€â”€ webrtc_service.dart          # WebRTC è§†é¢‘/éŸ³é¢‘/æ•°æ®é€šé“
â”‚   â”‚       â”œâ”€â”€ signaling_service.dart       # TCP ä¿¡ä»¤æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ esp32_service.dart           # BLE è¿æ¥ ESP32
â”‚   â”‚       â”œâ”€â”€ dual_camera_service.dart     # åŒæ‘„åƒå¤´ï¼ˆç”»ä¸­ç”»ï¼‰
â”‚   â”‚       â””â”€â”€ native_wakelock.dart         # å±å¹•å¸¸äº®
â”‚   â”œâ”€â”€ android/                  # Android åŸç”Ÿä»£ç 
â”‚   â””â”€â”€ pubspec.yaml
â”œâ”€â”€ firmware/                     # ESP32 å›ºä»¶
â”‚   â”œâ”€â”€ src/main.cpp              # BLE + PWM æ§åˆ¶
â”‚   â”œâ”€â”€ platformio.ini
â”‚   â””â”€â”€ CIRCUIT.md                # ç”µè·¯å›¾
â”œâ”€â”€ LICENSE
â””â”€â”€ README.md
```

## é€šä¿¡åè®®

### ä¿¡ä»¤ï¼ˆTCP Socketï¼‰

å‘é€ç«¯å¯åŠ¨ TCP Serverï¼ˆç«¯å£ 8765ï¼‰ï¼Œæ¥æ”¶ç«¯æ‰«ç åè¿æ¥ã€‚æ‰€æœ‰æ¶ˆæ¯ä¸º JSON + æ¢è¡Œç¬¦ã€‚

| æ¶ˆæ¯ç±»å‹ | æ–¹å‘ | è¯´æ˜ |
|---------|------|------|
| `offer` / `answer` | åŒå‘ | WebRTC SDP äº¤æ¢ |
| `candidate` | åŒå‘ | ICE Candidate |
| `gps_update` | å‘é€â†’æ¥æ”¶ | GPS åæ ‡ã€é€Ÿåº¦ã€æµ·æ‹” |
| `battery_update` | å‘é€â†’æ¥æ”¶ | æ‰‹æœºç”µé‡ |
| `esp32_status` | å‘é€â†’æ¥æ”¶ | ESP32 è¿æ¥çŠ¶æ€ |
| `esp32_battery` | å‘é€â†’æ¥æ”¶ | è½¦è¾†ç”µæ± ç”µé‡ |
| `resolution_request` | æ¥æ”¶â†’å‘é€ | åˆ‡æ¢åˆ†è¾¨ç‡ |
| `flashlight_toggle` | æ¥æ”¶â†’å‘é€ | å¼€å…³æ‰‹ç”µç­’ |
| `camera_switch` | æ¥æ”¶â†’å‘é€ | å‰åæ‘„åƒå¤´åˆ‡æ¢ |
| `bitrate_config` | æ¥æ”¶â†’å‘é€ | ç ç‡è°ƒæ•´ |
| `orientation_config` | æ¥æ”¶â†’å‘é€ | æ¨ªå±/ç«–å± |
| `pip_config` | æ¥æ”¶â†’å‘é€ | ç”»ä¸­ç”»å¼€å…³ |
| `disconnect` | åŒå‘ | æ–­å¼€è¿æ¥ |

### é¥æ§æŒ‡ä»¤ï¼ˆWebRTC DataChannel â†’ BLEï¼‰

æ ¼å¼ï¼š`RC:S:{steering},T:{throttle}`

- `steering`: 1000~2000ï¼Œ1500 ä¸ºä¸­ä½
- `throttle`: 1000~2000ï¼Œ1500 ä¸ºåœæ­¢

### BLE åè®®ï¼ˆESP32ï¼‰

| UUID | è¯´æ˜ |
|------|------|
| `12345678-...-abc` | Service |
| `12345678-...-abd` | å‘½ä»¤ç‰¹å¾ï¼ˆWrite NRï¼‰â€”â€” æ¥æ”¶ `S:{s},T:{t}` |
| `12345678-...-abe` | ç”µæ± ç‰¹å¾ï¼ˆNotifyï¼‰â€”â€” å‘é€ç”µæ± ç™¾åˆ†æ¯” |

## License

[MIT](LICENSE) Â© 2026 NORMAL-EX
